# Open Notes Production Environment Configuration
#
# CRITICAL SECURITY REQUIREMENTS:
# - NEVER commit this file with real secrets
# - Generate all secrets with cryptographically secure methods
# - Use strong passwords (20+ characters, mixed case, numbers, symbols)
# - Rotate secrets regularly (every 90 days minimum)
# - Enable all security features
# - Monitor for anomalies
#
# Copy to .env.yaml and customize with your production credentials.

# ============================================================================
# CORE ENVIRONMENT
# ============================================================================

ENVIRONMENT: production
SERVICE: all
DEBUG: false
LOG_LEVEL: WARNING
LOG_LEVEL_OVERRIDES: ""

# ============================================================================
# DATABASE - PostgreSQL
# ============================================================================

POSTGRES_DB: opennotes
POSTGRES_USER: opennotes
# Generate strong password: openssl rand -base64 32
POSTGRES_PASSWORD: CHANGE_THIS_USE_STRONG_PASSWORD_MIN_32_CHARS
DATABASE_URL: "postgresql+asyncpg://opennotes:CHANGE_THIS@postgres:5432/opennotes"

# ============================================================================
# CACHE - Redis
# ============================================================================

REDIS_URL: "redis://redis:6379/0"
REDIS_DB: 0
REDIS_MAX_CONNECTIONS: 50

# Cache TTL settings (optimized for production)
CACHE_SCORING_TTL: 600
CACHE_USER_PROFILE_TTL: 7200
CACHE_DEFAULT_TTL: 1200

# ============================================================================
# MESSAGE BROKER - NATS
# ============================================================================

NATS_URL: "nats://nats:4222"
NATS_STREAM_NAME: OPENNOTES
NATS_CONSUMER_NAME: opennotes-server
NATS_MAX_RECONNECT_ATTEMPTS: 10

# ============================================================================
# BACKEND SERVER
# ============================================================================

SERVER_HOST: 0.0.0.0
SERVER_PORT: 8000
OPENNOTES_SERVICE_URL: "http://opennotes-server:8000"
PROJECT_NAME: "Open Notes Server"
VERSION: 1.0.0

# Production CORS origins (IMPORTANT: Update with your actual domains)
CORS_ORIGINS: "https://yourdomain.com,https://app.yourdomain.com"

# Worker configuration (optimized for production load)
MAX_WORKERS: 4
WORKER_ENABLED: true
SCORING_ENABLED: true

# ============================================================================
# DISCORD BOT
# ============================================================================

# Get from Discord Developer Portal: https://discord.com/developers/applications
DISCORD_TOKEN: CHANGE_THIS_YOUR_PRODUCTION_DISCORD_BOT_TOKEN
DISCORD_CLIENT_ID: CHANGE_THIS_YOUR_DISCORD_CLIENT_ID
# Public key must be exactly 64 hex characters (32 bytes) - get from Discord Developer Portal
DISCORD_PUBLIC_KEY: CHANGE_THIS_64_HEX_CHARS_FROM_DISCORD_PORTAL_00000000000000
DISCORD_APPLICATION_ID: CHANGE_THIS_YOUR_DISCORD_APPLICATION_ID

# Discord bot API key for server authentication (generate via API)
OPENNOTES_API_KEY: CHANGE_THIS_GENERATE_VIA_API_KEYS_ENDPOINT

NODE_ENV: production
PORT: 3000

# ============================================================================
# SECURITY
# ============================================================================

# CRITICAL: Generate secure JWT secret (NEVER use defaults!)
# Generate with: openssl rand -hex 32
JWT_SECRET_KEY: CHANGE_THIS_GENERATE_WITH_OPENSSL_RAND_HEX_32
JWT_ALGORITHM: HS256
ACCESS_TOKEN_EXPIRE_MINUTES: 15
REFRESH_TOKEN_EXPIRE_DAYS: 7

# Rate limiting (strict for production)
RATE_LIMIT_ENABLED: true
RATE_LIMIT_PER_MINUTE: 30
WEBHOOK_RATE_LIMIT_PER_GUILD: 100
WEBHOOK_RATE_LIMIT_WINDOW: 60

# Circuit breaker configuration
CIRCUIT_BREAKER_FAILURE_THRESHOLD: 5
CIRCUIT_BREAKER_TIMEOUT: 60

# ============================================================================
# MONITORING & OBSERVABILITY
# ============================================================================

ENABLE_METRICS: true
ENABLE_TRACING: true
ENABLE_JSON_LOGGING: true
ENABLE_CONSOLE_TRACING: false

# OpenTelemetry endpoint
OTLP_ENDPOINT: "http://tempo:4317"

# ============================================================================
# ENCRYPTION KEYS (REQUIRED)
# ============================================================================

# Fernet key for credential encryption (CRITICAL: Generate unique key!)
# Generate with: python -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'
CREDENTIALS_ENCRYPTION_KEY: CHANGE_THIS_GENERATE_FERNET_KEY

# Master encryption key for LLM API keys (CRITICAL: Generate unique key!)
# Generate with: python -c 'import secrets, base64; print(base64.urlsafe_b64encode(secrets.token_bytes(32)).decode())'
ENCRYPTION_MASTER_KEY: CHANGE_THIS_GENERATE_32_BYTE_BASE64_KEY

# ============================================================================
# DOCKER & DEPLOYMENT
# ============================================================================

IMAGE_TAG: v1.0.0
REGISTRY: ghcr.io
IMAGE_REPO: opennotes-ai/multiverse

# ============================================================================
# DEVELOPMENT TOOLS
# ============================================================================

TESTING: 0

# ============================================================================
# PRODUCTION CHECKLIST
# ============================================================================
#
# Before deploying to production, ensure:
#
# ✅ All CHANGE_THIS placeholders have been replaced
# ✅ All secrets are cryptographically secure (32+ random bytes)
# ✅ JWT_SECRET_KEY is unique and never used elsewhere
# ✅ Database password is strong (32+ characters)
# ✅ Discord bot tokens are for production bot
# ✅ CORS_ORIGINS contains only your production domains
# ✅ Observability configured (Tempo/OTLP for tracing, Prometheus for metrics)
# ✅ DEBUG is set to false
# ✅ LOG_LEVEL is WARNING or ERROR
# ✅ This file is in .gitignore and never committed
# ✅ Secrets are stored in secure vault (e.g., AWS Secrets Manager)
# ✅ SSL/TLS certificates are valid and up to date
# ✅ Regular backups are configured
# ✅ Monitoring alerts are set up
# ✅ Rate limiting is enabled and tested
#
