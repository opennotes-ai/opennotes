global
    log stdout format raw local0
    maxconn 4096
    daemon

defaults
    log     global
    mode    http
    option  httplog
    option  dontlognull
    timeout connect 5000
    timeout client  50000
    timeout server  50000

frontend stats
    bind *:8404
    stats enable
    stats uri /stats
    stats refresh 10s
    stats admin if LOCALHOST

frontend health_check
    bind *:8080
    default_backend discord_bot_instances

backend discord_bot_instances
    balance roundrobin
    option httpchk GET /ready
    http-check expect status 200
    default-server inter 5s fall 3 rise 2

    server bot1 opennotes-discord-1:3000 check
    server bot2 opennotes-discord-2:3000 check
    server bot3 opennotes-discord-3:3000 check

listen discord_bot_health
    bind *:9000
    mode http
    stats enable
    stats uri /haproxy
    stats realm HAProxy\ Statistics
    stats auth admin:admin
    monitor-uri /health
