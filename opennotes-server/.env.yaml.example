# Open Notes Server Environment Configuration
# Copy this file to .env.yaml and customize for your environment

# Development Environment Configuration
ENVIRONMENT: development
DEBUG: true

PROJECT_NAME: "Open Notes Server"
VERSION: 1.0.0

SERVER_HOST: 0.0.0.0
SERVER_PORT: 8000

CORS_ORIGINS: "http://localhost:3000,http://localhost:5173,http://localhost:8000"

LOG_LEVEL: INFO

# Discord Configuration (replace with your actual credentials)
DISCORD_PUBLIC_KEY: your_discord_public_key_here
DISCORD_BOT_TOKEN: your_discord_bot_token_here
DISCORD_APPLICATION_ID: your_discord_application_id_here

# Database Configuration
DATABASE_URL: "postgresql+asyncpg://opennotes:opennotes_password@localhost:5432/opennotes"

# Redis Configuration
REDIS_URL: "redis://localhost:6379/0"
REDIS_MAX_CONNECTIONS: 10
REDIS_SOCKET_TIMEOUT: 5
REDIS_SOCKET_CONNECT_TIMEOUT: 5
REDIS_RETRY_ON_TIMEOUT: true

# Cache Configuration
CACHE_SCORING_TTL: 300
CACHE_USER_PROFILE_TTL: 3600
CACHE_DEFAULT_TTL: 600
CACHE_LLM_PRICING_TTL: 86400  # 24 hours - TTL for LLM pricing data cache

# Session Configuration
SESSION_TTL: 86400
SESSION_REFRESH_TTL: 604800

# NATS Configuration
NATS_URL: "nats://localhost:4222"
NATS_MAX_RECONNECT_ATTEMPTS: 10
NATS_RECONNECT_WAIT: 2
NATS_STREAM_NAME: OPENNOTES
NATS_CONSUMER_NAME: opennotes-server

# NATS Stream Configuration
# Controls stream retention and capacity limits
NATS_STREAM_MAX_AGE_SECONDS: 604800  # 7 days (86400 * 7)
NATS_STREAM_MAX_MESSAGES: 1000000    # Maximum number of messages stored
NATS_STREAM_MAX_BYTES: 1073741824    # Maximum total size (1GB)
NATS_STREAM_DUPLICATE_WINDOW_SECONDS: 120  # Duplicate detection window (2 minutes)

# Circuit Breaker Configuration
CIRCUIT_BREAKER_FAILURE_THRESHOLD: 5
CIRCUIT_BREAKER_TIMEOUT: 60
CIRCUIT_BREAKER_EXPECTED_EXCEPTION: Exception

# Webhook Configuration
WEBHOOK_RATE_LIMIT_PER_GUILD: 100
WEBHOOK_RATE_LIMIT_WINDOW: 60

# Interaction Cache Configuration
INTERACTION_CACHE_TTL: 300
INTERACTION_RESPONSE_TIMEOUT: 3

# Queue Configuration
QUEUE_MAX_RETRIES: 3
QUEUE_RETRY_DELAY: 1
QUEUE_RETRY_BACKOFF: 2.0

# JWT Configuration
# CRITICAL: JWT_SECRET_KEY must be changed in production!
# This key is used to sign JWT tokens. If it changes, all tokens become invalid.
# For production:
#   1. Generate a secure key: python -c 'import secrets; print(secrets.token_urlsafe(32))'
#   2. Set as environment variable (DO NOT commit to git)
#   3. Use the SAME key across all server instances in multi-instance deployments
# Minimum length: 32 characters (enforced)
JWT_SECRET_KEY: dev-secret-key-change-in-production-min-32-chars
JWT_ALGORITHM: HS256
ACCESS_TOKEN_EXPIRE_MINUTES: 30
REFRESH_TOKEN_EXPIRE_DAYS: 7

# Encryption Keys for Sensitive Data
# CRITICAL: Both encryption keys must be set for secure data storage!

# CREDENTIALS_ENCRYPTION_KEY: Used to encrypt sensitive data in UserIdentity.credentials field
# This key is used with Fernet symmetric encryption for credential storage.
# For production:
#   1. Generate a secure key: python -c 'from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())'
#   2. Set as environment variable (DO NOT commit to git)
#   3. Use the SAME key across all server instances to share encrypted data
# For development, a default test key is provided (replace in production):
CREDENTIALS_ENCRYPTION_KEY: "WnBxdZ2BU0Mh-jhZgVO2rRkncGmz0d54PTdyH_oaL38="

# ENCRYPTION_MASTER_KEY: Master encryption key for LLM API keys and other sensitive configuration
# This key must be URL-safe base64-encoded 32 bytes (256 bits) with high entropy.
# For production:
#   1. Generate a secure key: python -c 'import secrets, base64; print(base64.urlsafe_b64encode(secrets.token_bytes(32)).decode())'
#   2. Set as environment variable (DO NOT commit to git)
#   3. Use the SAME key across all server instances
# For development, a default test key is provided (replace in production):
ENCRYPTION_MASTER_KEY: "Eh1uymAtKUglSt9gjKN_Ft96bBOnu0Y8uNxm1AoNN-Q="

# Rate Limiting
RATE_LIMIT_PER_MINUTE: 60
RATE_LIMIT_ENABLED: true

# Monitoring and Observability
ENABLE_METRICS: true
ENABLE_TRACING: false
ENABLE_JSON_LOGGING: true

# OpenTelemetry (disabled for local dev)
OTLP_ENDPOINT: "http://localhost:4317"
ENABLE_CONSOLE_TRACING: false

# Embedding Configuration
SIMILARITY_SEARCH_DEFAULT_THRESHOLD: 0.75  # Default minimum similarity score (0.0-1.0) for embedding similarity search
PREVIOUSLY_SEEN_AUTOPUBLISH_THRESHOLD: 0.9  # Auto-publish threshold for previously seen messages (high confidence duplicate)
PREVIOUSLY_SEEN_AUTOREQUEST_THRESHOLD: 0.75  # Auto-request threshold for previously seen messages (moderate confidence)
